package com.my.login.controller;


import com.my.login.dto.LoginRequest;
import com.my.login.dto.LoginResponse;

import jakarta.servlet.http.HttpServletResponse;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.AuthenticationProvider;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.web.bind.annotation.*;

import java.io.IOException;

@RestController
@RequestMapping("/auth")
public class AuthController {

    private final AuthenticationManager authenticationManager;
    private final AuthenticationProvider authenticationProvider;

    public AuthController(AuthenticationManager authenticationManager, AuthenticationProvider authenticationProvider) {
        this.authenticationManager = authenticationManager;
        this.authenticationProvider = authenticationProvider;
    }

    /*
    @PostMapping("/login")
    public String login(@RequestBody LoginRequest loginRequest) {
        Authentication authentication = authenticationProvider.authenticate(
                new UsernamePasswordAuthenticationToken(
                        loginRequest.getUsername(), loginRequest.getPassword()));

        SecurityContextHolder.getContext().setAuthentication(authentication);
        //return new LoginResponse("Login successful", "dummy-token");
        System.out.println("Authentication successful");

        return "home";
    }

     */


    @PostMapping("/login")
    public void login(@RequestBody LoginRequest loginRequest, HttpServletResponse response) throws IOException {
        Authentication authentication = authenticationProvider.authenticate(
                new UsernamePasswordAuthenticationToken(loginRequest.getUsername(), loginRequest.getPassword()));

        SecurityContextHolder.getContext().setAuthentication(authentication);

        // Redirect to home page
        response.sendRedirect("/home");
    }


}
